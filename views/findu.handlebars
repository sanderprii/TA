{{!-- findu.handlebars --}}


<div class="container mt-5">
    <h2>Find Users</h2>
    <input type="text" id="search-input" class="form-control" placeholder="Search by username or full name">
    <ul id="search-results" class="list-group mt-3" style="display: none;"></ul>
</div>

<!-- Include the script -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('search-input');
        const resultsList = document.getElementById('search-results');

        let debounceTimeout = null;

        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim();

            clearTimeout(debounceTimeout);

            // Delay the request to avoid too many requests
            debounceTimeout = setTimeout(async () => {
                if (query.length === 0) {
                    resultsList.style.display = 'none';
                    resultsList.innerHTML = '';
                    return;
                }

                try {
                    const response = await fetch(`/api/search-users?q=${encodeURIComponent(query)}`);
                    if (response.ok) {
                        const users = await response.json();
                        resultsList.innerHTML = '';

                        if (users.length > 0) {
                            users.forEach(user => {
                                const li = document.createElement('li');
                                li.classList.add('list-group-item');
                                li.textContent = `${user.username} - ${user.fullName || ''}`;
                                li.style.cursor = 'pointer';
                                li.addEventListener('click', () => {
                                    window.location.href = `/user-records/${user.id}`;
                                });
                                resultsList.appendChild(li);
                            });
                            resultsList.style.display = 'block';
                        } else {
                            const li = document.createElement('li');
                            li.classList.add('list-group-item');
                            li.textContent = 'No users found.';
                            resultsList.appendChild(li);
                            resultsList.style.display = 'block';
                        }
                    } else {
                        console.error('Failed to fetch users');
                    }
                } catch (error) {
                    console.error('Error fetching users:', error);
                }
            }, 300); // Waits 300ms after typing stops
        });
    });
</script>
